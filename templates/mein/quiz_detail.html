{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta http-equiv="content-type" content="text/plain; charset=UTF-8"/>

  <title>Medical | Asosiy sahifa</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="/static/assets/img/favicon.png" rel="icon">
  <link href="/static/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.1/chart.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Template Main CSS File -->
  <link href="/static/assets/css/style.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>



</head>


<body>


  <header id="header" class="header fixed-top d-flex align-items-center">


    <div class="d-flex align-items-center justify-content-between">
      <a href="/" class="logo d-flex align-items-center">
        <img src="/static/assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">Medical</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->
    <div class="container">
      <div class="row" style="float: right;">
        <div class="col">
          <form action="" method="post">
           
            <a type="button" class="btn btn-outline-danger" href="#">Chiqish</a>
            
        </form>
        </div>
      </div>
    </div>
  </header><!-- End Header -->
  

</ul>

  <style>
    #form_update span{
display: flex;
flex-direction: column;
padding-bottom: 20px;
    }
    #form_update span label{
      line-height: 0;
      padding-bottom: 8px;
    }
     .msg{
        position: fixed;
        top: 80px;
        right: 0;
        width: 30%;
        animation: run 1s linear ;
        z-index: 100;
      }
      @keyframes run {
      from{ 
          transform: translateX(500px);   
      }
      to{
          transform: translateX(-8px);   
      }
}
    .nav-item:hover a{
      transform: scale(1.2);
    }
    .nav-item:hover i{
      margin-left: 20px;

    }
    .load-spinner{
      width: 100%;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;      
    }
    
  </style>
  


  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed " href="">
          <i class="bi bi-grid"></i>
          <span>Asosiy sahifa </span>
        </a>
      </li><!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="">
          <i class="bi bi-person-plus-fill"></i>
          <span>Ro'yhatga Olish </span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="">
          <i class="bi bi-people-fill"></i>
          <span>Umumiy Ro'yxat</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="">
          <i class="bi bi-person-dash"></i>
          <span>Talvasa xurujli bemorlar</span>
        </a>
      </li>
     
        
        </ul>
      </li><!-- End Forms Nav -->

      <!-- End Tables Nav -->


      <!-- End Blank Page Nav -->

    </ul>

  </aside><!-- End Sidebar-->

<style>
 
    .main form > label{
        margin-top: 17px;
    }

</style>


<main id="main" class="main">

<div style="display: flex; justify-content: center;">
    <form style="width: 80%;" class="text-start"  method="GET" >
      
          <label for="title">Sarlavha</label>
          <input id="title" value="{{quiz.title}}" required type="text" placeholder="Sarlavha" name="title" class="form-control">
          <label for="body">Quiz haqida</label>
          <textarea id="body"  required name="body" placeholder="Test haqida" style="resize: none;" class="form-control" >{{quiz.body}}</textarea>
          <label for="time">Quiz Vaqti</label>
          <input id="time" value="{{quiz.duraction_time}}" required type="number" placeholder="Testga ajratilgan vaqt minutda" name="duraction_time" class="form-control">
          <label for="score">O'tish bali % </label>
          <input id="score" value="{{quiz.is_score}}" required oninput="InvalidMsg(this)" type="number" placeholder="O'tish bali foyizda"  name="is_score" class="form-control">
          <label for="category">Category</label>
          <select class="form-select form-select-lg " id="category" name="category" >
            {% for c in category %}
            {% if quiz.categorys == c %}
              
            <option selected value="{{c.id}}">{{c.title}}</option>
            {% else %}
            <option  value="{{c.id}}">{{c.title}}</option>
            {% endif %}


            {% endfor %}
          </select>
          <br>
          <div class="d-flex align-items-center gap-3">
            <button id="submit" class="btn btn-primary" disabled type="submit">Saqlash</button>
            <input type="text" class="form-control w-75" value="{{quiz.random_url}}" id="myInput"> <br>
            <button class="btn btn-danger" onclick="myFunction()">Copy Url</button>
          </div>
    </form>
</div>


<center>

  <canvas id="chartId" aria-label="chart" ></canvas>
</center>

<div >
  <h2>Savollar royhati <span id="count_q"></span> </h2>
  <ul  style="width: 90%; max-height: 50vh; overflow-y: scroll;" id="quiz_l"  class="list-group">
  </ul>

  
<center style="width: 90%;">
  <button data-toggle="modal" data-target="#create"  class="btn btn-primary">Savol qo'shish</button> 
</center>

<div class="modal fade" id="create"  tabindex="-1" role="dialog" aria-labelledby="create" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">

      <div  id="show_quizdetail" class="modal-body">
<form >
<input class="form-control my-2" id="random_url" type="text" hidden name="random_url" value="{{quiz.random_url}}">
<input class="form-control my-2" id="title2" type="text" name="title" placeholder="Savol nomi">
<input class="form-control my-2" id="a" type="text" name="a" placeholder="A">
<input class="form-control my-2" id="b" type="text" name="b" placeholder="B">
<input class="form-control my-2" id="c" type="text" name="c" placeholder="C">
<input class="form-control my-2" id="d"  type="text" name="d" placeholder="D">
<select class="form-select form-select-lg" id="true_ansver" name="true_ansver" >
  <option value="a">A</option>
  <option value="b">B</option>
  <option value="c">C</option>
  <option value="d">D</option>
</select>
<input type="reset" hidden id="reset">
</form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Yopish</button>
        <button type="button" onclick="create()" class="btn btn-primary">Saqlash</button>
      </div>
    </div>
  </div>
</div>



</div>


</main>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">

      <div  id="show_quizdetail" class="modal-body">

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>






  <a  href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  var chrt = document.getElementById("chartId").getContext("2d");
  var chartId = new Chart(chrt, {
     type: 'pie',
     data: {
        labels: ["O'tganlar", "O'ta olmaganlar" ],
        datasets: [{
           // label: "online tutorial subjects",
           data: ['{{quiz_c.True|length}}', '{{quiz_c.False|length}}'   ],
           backgroundColor: [ 'lightgreen', 'red', ],
           hoverOffset: 5
        }],
     },
     options: {
        responsive: false,
     },
  });
</script>

  <script src="/static/assets/js/jquery-3.3.1.min.js"></script>

  <script  src="/static/assets/js/main.js"></script>
  

<script>

var copyText = document.getElementById("myInput");
copyText.value = `${location.origin +'/page/'+ copyText.value}`
function myFunction() {
  // Get the text field

  // Select the text field
  copyText.select();
  copyText.setSelectionRange(0, 99999); // For mobile devices

   // Copy the text inside the text field
  navigator.clipboard.writeText( copyText.value);
  alert(`Copied : ${copyText.value}`)

  // Alert the copied text
}
function InvalidMsg(textbox) {
        if (Number( textbox.value) > 100 ) {
            textbox.setCustomValidity('Faqat 1%  dan 100% gacha kiriting');
        }  else if (textbox.validity.patternMismatch){
            textbox.setCustomValidity('Entered name is not correct');
        } else {
           textbox.setCustomValidity('');
        }
    
        // return true;
    }
    
addEventListener("input",()=>{
        if(document.getElementById("title").value != '{{quiz.title}}' ||document.getElementById("body").value != '{{quiz.body}}' ||document.getElementById("time").value != '{{quiz.duraction_time}}'||document.getElementById("score").value != '{{quiz.is_score}}'||document.getElementById("category").value != '{{quiz.categorys.id}}' ){
            document.getElementById("submit").style.background = 'red'
            document.getElementById("submit").disabled = false
    
        }
    
        else{
            document.getElementById("submit").style.background = '#0d6efd'
            document.getElementById("submit").disabled = true
        }
    })
    
let href = location.href
    

function ajax(){
  $.ajax({
      url: `${location.href}`,
      type: "GET",
      dataType: "json",
      success: (data) => {
        document.getElementById('quiz_l').innerHTML =''
        document.getElementById('count_q').innerHTML = data['context'].length
    console.log(data['context']);
    for (const iterator of data['context']) {
      console.log(iterator['title']);
      let li = document.createElement("li")
      li.className = 'list-group-item bg-light border border-primary d-flex justify-content-between align-items-center'
      let select= ''
      console.log(iterator['true_ansver'])
      if(iterator['true_ansver'] =='a'){
        select=`
        <select class="form-select form-select-lg my-2 " name="true_ansver">
            <option selected value="a">A</option>
            <option value="b">B</option>
            <option value="c">C</option>
            <option value="d">D</option>
        </select>
        `
      }
      else if(iterator['true_ansver'] =='b'){
        select=`
        <select class="form-select form-select-lg my-2 " name="true_ansver">
            <option  value="a">A</option>
            <option selected value="b">B</option>
            <option value="c">C</option>
            <option value="d">D</option>
        </select>
        `
      }
      else if(iterator['true_ansver'] =='c'){
        select=`
        <select class="form-select form-select-lg my-2 " name="true_ansver">
            <option  value="a">A</option>
            <option  value="b">B</option>
            <option selected value="c">C</option>
            <option value="d">D</option>
        </select>
        `
      }
      else if(iterator['true_ansver'] =='d'){
        select=`
        <select class="form-select form-select-lg my-2 " name="true_ansver">
            <option  value="a">A</option>
            <option  value="b">B</option>
            <option value="c">C</option>
            <option selected value="d">D</option>
        </select>
        `
      }

      li.innerHTML = `
         <a data-toggle="modal" onclick="clickmodal(this)"  data-target="#exampleModalCenter"
          data-a="${iterator['a']}"
          data-b="${iterator['b']}"
          data-c="${iterator['c']}"
          data-d="${iterator['d']}"
          data-title="${iterator['title']}"
          data-true_ansver="${iterator['true_ansver']}"
          class="fs-3">${iterator['title']}</a> 
       <span class="d-flex align-items-center gap-2">
         <i onclick="quiz_listremove('${iterator['random_url']}')" class="fa fa-trash text-danger fs-2" aria-hidden="true"></i>
         <i data-toggle="modal" data-target="#${iterator['random_url']}" class="fas fa-edit text-success fs-2"></i>

         <div class="modal fade" id="${iterator['random_url']}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">

      <div   class="modal-body">
        <form action="/quetions_list_update/${iterator['random_url']}" method="GET" >
          <input class="form-control my-1" type="text" value="${iterator['title']}" name="title">
          <input class="form-control my-1" type="text" value="${iterator['a']}" name="a">
          <input class="form-control my-1" type="text" value="${iterator['b']}" name="b">
          <input class="form-control my-1" type="text" value="${iterator['c']}" name="c">
          <input class="form-control my-1" type="text" value="${iterator['d']}" name="d">
          
${
  select
}
<div   class='d-flex'>

          <input class="btn btn-primary w-50" type="submit" value="Saqlash">
          <button type="button" class="btn btn-danger w-50" data-dismiss="modal">Yopish</button>
        </div>

        </form>
      
      </div>


    </div>
  </div>
</div>

       </span>
      `
      document.getElementById('quiz_l').prepend(li)
      
    }

// quiz_l

    // <li  class="list-group-item bg-ligth my-1 d-flex justify-content-between align-items-center ">
    //    <span class="fs-3">A disabled item</span> 
    //    <span class="d-flex align-items-center gap-2">
    //      <i class="fa fa-trash text-danger fs-2" aria-hidden="true"></i>
    //      <i class="fas fa-edit text-success fs-2"></i>
    //    </span>
    // </li>
      },
      error: (error) => {
    
      }
    });
    

    }

function quiz_listremove(url1){
   
      let getrl = location.origin + '/quetions_list_remove/'+url1
      let rem = new XMLHttpRequest()
      rem.open("GET", getrl)
  
      rem.send()
      ajax()
      ajax()


    }
ajax()

function clickmodal(x) {
 
  document.getElementById('show_quizdetail').innerHTML = `
  
  <h4>${x.getAttribute('data-title')}</h4>
       <p>A : ${x.getAttribute('data-a')}</p>
       <p>B : ${x.getAttribute('data-b')}</p>
       <p>C : ${x.getAttribute('data-c')}</p>
       <p>D : ${x.getAttribute('data-d')}</p>
       <p>True : ${x.getAttribute('data-true_ansver').toUpperCase()}</p>
  `


  
}


console.log(location.origin);
function update_ajax(){
  $.ajax({
      url: `${location.href}`,
      type: "GET",
      dataType: "json",
      success: (data) => {

      },
      error: (error) => {
    
      }
    });
    

    }
let xml= new XMLHttpRequest()
function create(){
  
  let random_url = document.getElementById('random_url').value
  let title = document.getElementById('title2').value
  let a = document.getElementById('a').value
  let b = document.getElementById('b').value
  let c = document.getElementById('c').value
  let d = document.getElementById('d').value
  let true_ansver = document.getElementById('true_ansver').value
  if( random_url.length && title.length && a.length && b.length && c.length && d.length > 0 ){
xml.open("GET",`${location.origin}/quetions_list_create/?random_url=${random_url}&a=${a}&b=${b}&c=${c}&d=${d}&true_ansver=${true_ansver}&title=${title}`)
xml.send()
ajax()
document.getElementById('reset').click()
  }else{
    alert('Notogri toliq kiriting')
  }


}


</script>
    
  

</body>

</html>